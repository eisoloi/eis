<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eistabelle - PWA</title>
  <link rel="manifest" href="manifest.json"> <!-- Manifest-Datei -->
  <link rel="icon" href="icons/favicon.ico">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    #installButton {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #008CBA;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      display: none;
    }
    #installButton:hover {
      background-color: #006f8e;
    }
  </style>
</head>
<body>
  <div id="startScreen">
    <button onclick="startApp()">App starten</button>
  </div>
  <div id="app" style="display:none;">
    <h1>Willkommen bei der Eistabelle</h1>
    <button onclick="addRow()">Neue Zeile hinzufügen</button>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>iH</th>
          <th>aH</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
    <button onclick="showDeleteModal()">Zeile löschen</button>
  </div>

  <!-- Installationsbutton -->
  <button id="installButton">Installiere auf dem Homescreen</button>

  <script>
    const storageKey = "eistabelleData";
    const startScreenKey = "eistabelleVisited";

    // Alphabetisch sortierte Eissorten mit Überschriften
    const defaultSorten = [
      "A", "Amadeus", "Amarena-Kirsch", "Ananas", "Ananas-Rosmarien", "Aperol Spritz", "Apfel", "Aprikose",
      "B", "Bacio", "Banane", "Basil", "Biscoff (Spekulatius)", "Brownie",
      "C", "Cassis", "Cherrymania", "Chocoprezel", "Choco bello", "Cookies", "Crema Italiana", "Cheesecake", "Cheesecake, Caramel, Cookies",
      "D", "Dulce de Leche", "dunkle Schokolade",
      "E", "Erdbeere", "Erdbeere-Prosecco", "Espresso-Chip", "Erdnuss-Karamell", "Erdnuss, Honig, Schoko", "Erdbeer-Karamell",
      "G", "Griesflammerie", "Gurke", "Granatapfel, Blutorange",
      "H", "Heidelbeere", "Himbeere", "Himbeere, Rhabarber", "Haselnuss", "Himmelblau",
      "I", "Indische Mango",
      "J", "Joghurt-Natur", "Joghurt-Orange", "Joghurt-Kirsche", "Joghurt-Gurke", "Joghurt-Maracuja",
      "K", "Kaki", "Kinde", "Kokosnuss", "Kokos-Limette", "Kiwi", "Kaktus-Feige", "Kastanie",
      "L", "Limette-Minze",
      "M", "Miss Purple (Süßkartoffel)", "Mandel", "Mandel-Krokant", "Malage", "Melone", "Menta",
      "O", "Orange-Basilikum", "Omas Apfelkuchen",
      "P", "Papaya", "Pistazie", "Praline-Haselnuss", "Pfirsich-Maracuja", "Pflaume-Zimt",
      "Q", "Quark-Himbeere", "Quark-Holunder",
      "S", "Sacher-Art", "Sesamkrokant", "Schokolade", "salziges Karamell", "Stracciatella", "Schoko-Banane", "Schoko-Kirsch", "Schoko-Brezel",
      "T", "Tiramisu",
      "U", "Uhu",
      "V", "Vitaminbombe", "Vanille",
      "W", "Waldmeister", "Waldfrucht", "Walnuss-Feige", "weiße Schokolade",
      "Z", "Zabaione (Eierlikör)", "Zitrone"
    ];

    // App starten (per Button vom Startbildschirm)
    function startApp() {
      localStorage.setItem(startScreenKey, "1"); // Als besucht markieren
      document.getElementById("startScreen").style.display = "none";
      document.getElementById("app").style.display = "block";
      initializeData();
    }

    // Startbildschirm bei erstem Besuch anzeigen
    window.addEventListener("DOMContentLoaded", () => {
      const visited = localStorage.getItem(startScreenKey);
      if (visited) {
        document.getElementById("startScreen").style.display = "none";
        document.getElementById("app").style.display = "block";
        initializeData();
      } else {
        document.getElementById("startScreen").style.display = "block";
        document.getElementById("app").style.display = "none";
      }
    });

    // Daten initialisieren, wenn leer
    function initializeData() {
      if (!localStorage.getItem(storageKey)) {
        const data = defaultSorten.map(name => ({ name, iH: "", aH: "" }));
        localStorage.setItem(storageKey, JSON.stringify(data));
      }
      loadData();
    }

    // Daten laden und Tabelle aufbauen
    function loadData() {
      const saved = localStorage.getItem(storageKey);
      if (!saved) return;

      const data = JSON.parse(saved);
      const tableBody = document.getElementById("tableBody");
      tableBody.innerHTML = "";

      data.forEach(entry => {
        const row = createRow(entry.name, entry.iH, entry.aH);
        tableBody.appendChild(row);
      });
    }

    // Tabellenzeile erzeugen
    function createRow(name, iH, aH) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><input class="name" type="text" value="${name}"></td>
        <td><input class="iH" type="number" value="${iH}"></td>
        <td><input class="aH" type="number" value="${aH}"></td>
      `;
      return tr;
    }

    // Neue Zeile hinzufügen
    function addRow() {
      const tableBody = document.getElementById("tableBody");
      const row = createRow("", "", "");
      tableBody.appendChild(row);
      saveData();
    }

    // Speichern
    function saveData() {
      const data = [];
      const rows = document.querySelectorAll("#tableBody tr");
      rows.forEach(row => {
        const name = row.querySelector(".name").value;
        const iH = row.querySelector(".iH").value;
        const aH = row.querySelector(".aH").value;
        data.push({ name, iH, aH });
      });
      localStorage.setItem(storageKey, JSON.stringify(data));
    }

    // Service Worker Registrierung
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(err => {
          console.error("Service Worker Fehler:", err);
        });
      });
    }

    // Installationsbutton
    let deferredPrompt;
    const installBtn = document.getElementById('installButton');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'inline-block';

      installBtn.addEventListener('click', () => {
        installBtn.style.display = 'none';
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('App wurde zur Installation akzeptiert.');
          } else {
            console.log('App-Installation wurde abgelehnt.');
          }
          deferredPrompt = null;
        });
      });
    });
  </script>
</body>
</html>
